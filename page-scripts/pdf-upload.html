<!DOCTYPE html>
<html>
<head>
  <script src="pdf-viewer.js?v=21.8.15.0"></script>
  <script>
    (function() {
      var queue = new EventQueue("PdfDoc");

      queue.once("pageScriptLoaded", function() {
        var queryString = getQueryString()
        queue.trigger("loadDocument", queryString.url || "file:///")
      })

      var documentReady = new Promise(function(fulfill) {
        queue.once("documentLoaded", fulfill)
      })

      queue.on("waitDocumentReady", function() {
        documentReady.then(function() {
          queue.trigger("documentReady")
        })
      })

      function EventQueue(prefix) {
        this.on = function(eventType, callback) {
          document.addEventListener(prefix+eventType, function(event) {
            callback.apply(null, JSON.parse(event.detail));
          })
          return this;
        }
        this.once = function(eventType, callback) {
          var handler = function(event) {
            document.removeEventListener(prefix+eventType, handler);
            callback.apply(null, JSON.parse(event.detail));
          };
          document.addEventListener(prefix+eventType, handler);
          return this;
        }
        this.trigger = function(eventType) {
          var args = Array.prototype.slice.call(arguments, 1);
          document.dispatchEvent(new CustomEvent(prefix+eventType, {detail: JSON.stringify(args)}));
          return this;
        }
      }

      function getQueryString() {
        return location.search ? parseQueryString(location.search) : {};
      }

      function parseQueryString(search) {
        if (search.charAt(0) != '?') throw new Error("Invalid argument");
        var queryString = {};
        search.substr(1).replace(/\+/g, '%20').split('&').forEach(function(tuple) {
          var tokens = tuple.split('=');
          queryString[decodeURIComponent(tokens[0])] = tokens[1] && decodeURIComponent(tokens[1]);
        })
        return queryString;
      }
    })();
  </script>
</head>
<body>
</body>
</html>